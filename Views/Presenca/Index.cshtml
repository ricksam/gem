@using GEM.Helpers;
@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
@{
    ViewBag.Title = "Presenca";
    UserSession sessao = UserSession.Get(HttpContextAccessor.HttpContext);
    int DefaultComum = sessao.UserLogged? sessao.Usuario.Cod_Comum : 0;
}

<h2>Presencas</h2>
<div class="row">
    @if(sessao.Admin){
        <div class="form-group col-sm-6">
            <label class="control-label">Comum Congregação</label>
            @await Html.PartialAsync("~/Views/Shared/_Combo.cshtml", new GEM.Models.Combo(){
                Class="form-control",
                Name="Cod_Comum",
                OnChange="ComumChange(this)",
                Items=GEM.Repository.Comum.List().Select(e=>new ComboItem(){Text=e.Nome,Value=e.Cod_Comum.ToString()}).ToList(),
                SelectedItem=(ViewBag.Cod_Comum != null ? ViewBag.Cod_Comum.ToString() : DefaultComum.ToString())
            })
        </div>  
    }
</div>
<div class="row">
    <div class="form-group col-sm-6">
        <label>Data</label>
        <input type="date" class="form-control">
    </div>
</div>

<div id="ListaPresencas">
    Selecione uma data para registrar as presenças
</div>

@section Scripts{
    <script type="text/javascript">
        let Cod_Comum = @(DefaultComum);
        let Tipo = "";
        $(document).ready(() => {
            Lista();
        });

        function Filtro(tipo){
            Tipo = tipo;
            Lista();
        }

        function Lista() {
            rsp.get(null, "/Presenca/List?Cod_Comum="+Cod_Comum+"&q="+Tipo, (res) => {
                $("#ListaPresencas").html(res);
                $("#ListaPresencas .table").DataTable({
                    "pageLength": 100,
                    "bPaginate": true,
                    "bLengthChange": false,
                    "bFilter": true,
                    "bInfo": false,
                    "bAutoWidth": false,
                    /*"columns": [
                        null,
                        null,
                        null,
                        null,
                        null,
                        { "sType": "date-pt" },
                        null
                    ],*/
                    "language": {
                        "url": "//cdn.datatables.net/plug-ins/1.10.19/i18n/Portuguese-Brasil.json"
                    }
                });
                setTimeout(()=>{
                    $("#DataTables_Table_0_wrapper .col-sm-12").css("overflow", "auto");
                },200);
            });
        }
    </script>
}


